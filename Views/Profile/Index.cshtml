@model TourismWeb.Models.User
@using TourismWeb.Models 
@section Styles {
    <link rel="stylesheet" href="~/css/userprofile.css" asp-append-version="true" />
}

@{
    ViewData["Title"] = "Trang c√° nh√¢n user";
    var successMessage = TempData["SuccessMessage"] as string;
    var errorMessage = TempData["ErrorMessage"] as string;

}

@* @if (!string.IsNullOrEmpty(successMessage))
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @successMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @errorMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
} *@

<main>
    <div class="profile-container">
        <div class="profile-sidebar">
            <div class="card-body p-4">
               <div class="text-center mb-4">
                   <div class="avatar-container position-relative mx-auto" style="width: 150px; height: 150px;">
                      <!-- Current avatar display -->
                <div class="rounded-circle overflow-hidden border border-3 border-light shadow-sm" style="width: 150px; height: 150px;">
                    <img src="@Model.AvatarUrl" alt="@Model.FullName" class="w-100 h-100 object-fit-cover" id="avatarPreview">
                </div>
                
                <!-- Camera icon button -->
                    <div class="position-absolute bottom-0 end-0 bg-primary text-white p-2 rounded-circle shadow cursor-pointer" 
                                 style="cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; right: 5px; bottom: 5px; z-index: 10;" 
                                 onclick="document.getElementById('avatarFile').click()">
                                <i class="bi bi-camera-fill" style="font-size: 1.2rem;"></i>
                    </div>
                <!-- Hover overlay -->
                <div class="avatar-overlay position-absolute top-0 start-0 w-100 h-100 rounded-circle d-flex align-items-center justify-content-center" 
                     style="background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.2s ease;"
                     onclick="document.getElementById('avatarFile').click()">
                    <i class="bi bi-camera-fill text-white fs-3"></i>
                </div>
            </div>
        </div>

        <form asp-controller="Profile" asp-action="UploadAvatar" method="post" enctype="multipart/form-data" id="avatarForm">
        <input type="file" id="avatarFile" name="avatarFile" accept="image/*" class="d-none" onchange="handleFileChange(this)">
            <div id="uploadingMessage" class="text-center mb-3 text-muted small d-none">
                            ƒêang c·∫≠p nh·∫≠t ·∫£nh ƒë·∫°i di·ªán...
                        </div>
                    </form>
    </div>

            <h2 class="profile-name">@Model.FullName</h2>

            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-number">@Model.Posts.Count</div>
                    <div class="stat-label">B√†i vi·∫øt</div>
                </div>
            </div>

            <ul class="profile-menu">
                <li><a href="#thongtin-tai-khoan">H·ªì s∆°</a></li>
                <li><a href="#bo-suu-tap">B·ªô s∆∞u t·∫≠p ·∫£nh</a></li>
                <li><a href="#bai-viet">B√†i vi·∫øt c·ªßa t√¥i</a></li>
                <li><a href="#danh-gia">ƒê√°nh gi√° c·ªßa t√¥i</a></li>
                <li><a href="#binh-luan">B√¨nh lu·∫≠n c·ªßa t√¥i</a></li>
                <li><a href="#dia-diem-yeu-thich">ƒê·ªãa ƒëi·ªÉm y√™u th√≠ch</a></li>
                <li><a href="#bai-viet-yeu-thich">B√†i vi·∫øt y√™u th√≠ch</a></li>
            </ul>
        </div>

        <div class="profile-content">
            @if (!string.IsNullOrEmpty(successMessage))
             {
                 <div class="alert alert-success alert-dismissible fade show" role="alert">
                           @successMessage
                          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                 </div>
             }
             @if (!string.IsNullOrEmpty(errorMessage))
             {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            @errorMessage
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
             }
             @* Hi·ªÉn th·ªã t√≥m t·∫Øt l·ªói validation t·ª´ ModelState *@
             <div asp-validation-summary="ModelOnly" class="text-danger alert alert-danger"></div>
            <div class="profile-tabs">
                <div class="tab active" data-tab="account">Th√¥ng tin t√†i kho·∫£n</div>
                <div class="tab" data-tab="security">M·∫≠t kh·∫©u & B·∫£o m·∫≠t</div>
            </div>

            <div id="account-tab" class="tab-content active">
    <form asp-controller="Profile" asp-action="UpdateProfile" method="post">
        @Html.AntiForgeryToken()

        <div class="content-section" id="thongtin-tai-khoan">
            <h3 class="section-title">D·ªØ li·ªáu c√° nh√¢n</h3>
            <div class="form-group">
                <label class="form-label" for="FullNameInput">T√™n ƒë·∫ßy ƒë·ªß</label>
                <input type="text" id="FullNameInput" name="FullName" class="form-input form-control" value="@Model.FullName">
                <span class="text-danger">@Html.ValidationMessage("FullName")</span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Ng√†y sinh</label>
                    <div class="date-selects">
                        @{
                            var birthDate = Model.DateOfBirth;
                            var day = birthDate?.Day ?? 0;
                            var month = birthDate?.Month ?? 0;
                            var year = birthDate?.Year ?? 0;

                            if (ViewData.ModelState.TryGetValue("BirthDay", out var dayState) && dayState.AttemptedValue != null)
                                int.TryParse(dayState.AttemptedValue, out day);
                            if (ViewData.ModelState.TryGetValue("BirthMonth", out var monthState) && monthState.AttemptedValue != null)
                                int.TryParse(monthState.AttemptedValue, out month);
                            if (ViewData.ModelState.TryGetValue("BirthYear", out var yearState) && yearState.AttemptedValue != null)
                                int.TryParse(yearState.AttemptedValue, out year);
                        }

                        <select class="form-select" name="BirthDay">
                            <option value="0" selected="@(day == 0)">Ng√†y</option>
                            @for (int i = 1; i <= 31; i++)
                            {
                                <option value="@i" selected="@(day == i)">@i</option>
                            }
                        </select>
                        <select class="form-select" name="BirthMonth">
                            <option value="0" selected="@(month == 0)">Th√°ng</option>
                            @for (int i = 1; i <= 12; i++)
                            {
                                <option value="@i" selected="@(month == i)">Th√°ng @i</option>
                            }
                        </select>
                        <select class="form-select" name="BirthYear">
                            <option value="0" selected="@(year == 0)">NƒÉm</option>
                            @{
                                int currentYear = DateTime.Now.Year;
                                for (int i = currentYear; i >= currentYear - 100; i--)
                                {
                                    <option value="@i" selected="@(year == i)">@i</option>
                                }
                            }
                        </select>
                    </div>
                    <span class="text-danger">@Html.ValidationMessage("DateOfBirth")</span>
                </div>
            </div>

            <div class="button-group mt-4">
                <button type="reset" class="btn btn-outline">H·ªßy thay ƒë·ªïi</button>
                <button type="submit" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>

        <div class="content-section">
            <h3 class="section-title">Email</h3>
            <div class="email-item">
                <p class="email-title" style="margin: 0;">@Model.Email</p>
                <span class="notification-badge">N∆°i nh·∫≠n th√¥ng b√°o</span>
            </div>
            @if (string.IsNullOrEmpty(Model.Email))
            {
                <div class="button-group">
                    <button class="btn btn-outline"><i class="icon-plus"></i> Th√™m email</button>
                </div>
            }
        </div>

        <div class="content-section"> 
                        <h3 class="section-title">S·ªë di ƒë·ªông</h3>
                         <div class="form-group">
                            <label class="form-label" for="PhoneNumberInput">S·ªë di ƒë·ªông</label>
                            <input type="tel" id="PhoneNumberInput" name="PhoneNumber" class="form-input form-control" value="@Model.PhoneNumber">
                            <span class="text-danger">@Html.ValidationMessage("PhoneNumber")</span>
                            
                            <div class="button-group mt-4"></div>
                <button type="reset" class="btn btn-outline">H·ªßy thay ƒë·ªïi</button>
                <button type="submit" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </form>
</div>


                    @* @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                    {
                        <div class="email-item">
                            <div>
                                <p class="email-title">@Model.PhoneNumber</p>
                            </div>
                        </div>
                    }

                    <div class="button-group">
                        <button class="btn btn-outline">
                            <i class="icon-plus"></i>
                            Th√™m s·ªë di ƒë·ªông
                        </button>
                    </div>
                </div>
            </div> *@

            <div id="security-tab" class="tab-content @(ViewData["ActiveTab"] as string == "security" ? "active" : "")">
                <form asp-controller="Profile" asp-action="UpdatePassword" method="post">
                     @Html.AntiForgeryToken()

                     <div class="content-section" id="cai-dat">
                        <h3 class="section-title">M·∫≠t kh·∫©u & B·∫£o m·∫≠t</h3>
                        <p class="card-description">Qu·∫£n l√Ω m·∫≠t kh·∫©u v√† c√°c t√πy ch·ªçn b·∫£o m·∫≠t cho t√†i kho·∫£n c·ªßa b·∫°n</p>
                         @* Hi·ªÉn th·ªã l·ªói chung t·ª´ ModelState n·∫øu c√≥ *@
                         <div asp-validation-summary="ModelOnly" class="text-danger alert alert-danger"></div>

                        <div class="form-group">
                            <label class="form-label" for="CurrentPasswordInput">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                            <input type="password" id="CurrentPasswordInput" name="CurrentPassword" class="form-input form-control" required>
                            <span class="text-danger">@Html.ValidationMessage("CurrentPassword")</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="NewPasswordInput">M·∫≠t kh·∫©u m·ªõi</label>
                            <input type="password" id="NewPasswordInput" name="NewPassword" class="form-input form-control" required>
                            <span class="text-danger">@Html.ValidationMessage("NewPassword")</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="ConfirmPasswordInput">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                            <input type="password" id="ConfirmPasswordInput" name="ConfirmPassword" class="form-input form-control" required>
                            <span class="text-danger">@Html.ValidationMessage("ConfirmPassword")</span>
                        </div>

                        <div class="button-group mt-3">
                            <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u</button>
                        </div>
                    </div>
                </form>
            </div>

                @* <div class="content-section">
                    <h3 class="section-title">X√°c th·ª±c hai y·∫øu t·ªë</h3>
                    <p class="card-description">TƒÉng c∆∞·ªùng b·∫£o m·∫≠t cho t√†i kho·∫£n c·ªßa b·∫°n</p>

                    <div class="toggle-item">
                        <div>
                            <p class="toggle-title">X√°c th·ª±c qua SMS</p>
                            <p class="toggle-description">Nh·∫≠n m√£ x√°c th·ª±c qua tin nh·∫Øn SMS</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="toggle-item">
                        <div>
                            <p class="toggle-title">X√°c th·ª±c qua ·ª©ng d·ª•ng</p>
                            <p class="toggle-description">S·ª≠ d·ª•ng ·ª©ng d·ª•ng x√°c th·ª±c nh∆∞ Google Authenticator</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div> *@
 @{
    var defaultPostImageUrl = "/images/default-postImage.png";
    var defaultReviewImageUrl = "/images/default-postImage.png";

    List<object> allGalleryImageObjects = new List<object>();

     // 1. L·∫•y ·∫£nh t·ª´ Model.Reviews c·ªßa User
    if (Model?.Reviews != null && Model.Reviews.Any())
    {
         allGalleryImageObjects.AddRange(Model.Reviews
            .Where(review => review.ImageUrl != null &&
                             !string.IsNullOrEmpty(review.ImageUrl.Trim()) &&
                             review.ImageUrl.Trim().ToLower() != defaultReviewImageUrl.ToLower())
            .Select(review => new { // T·∫°o ƒë·ªëi t∆∞·ª£ng ·∫©n danh
                SourceType = "Review", // Th√™m ƒë·ªÉ d·ªÖ debug n·∫øu c·∫ßn
                ImageUrl = review.ImageUrl,
                AltText = $"·∫¢nh t·ª´ ƒë√°nh gi√° cho {review.Spot?.Name ?? "ƒê·ªãa ƒëi·ªÉm"}",
                CreatedAt = review.CreatedAt
            }));
    }
    // 2. L·∫•y ·∫£nh t·ª´ Model.Posts c·ªßa User
    if (Model?.Posts != null)
    {
        allGalleryImageObjects.AddRange(Model.Posts
            .Where(post => post.ImageUrl != null &&
                           !string.IsNullOrEmpty(post.ImageUrl.Trim()) &&
                           post.ImageUrl.Trim().ToLower() != defaultPostImageUrl.ToLower())
            .Select(post => new { // T·∫°o ƒë·ªëi t∆∞·ª£ng ·∫©n danh
                SourceType = "Post", // Th√™m ƒë·ªÉ d·ªÖ debug n·∫øu c·∫ßn
                ImageUrl = post.ImageUrl,
                AltText = $"·∫¢nh t·ª´ b√†i vi·∫øt: {post.Title ?? (post.Spot?.Name ?? "N·ªôi dung")}",
                CreatedAt = post.CreatedAt
            }));
    }

    // 3. S·∫Øp x·∫øp t·∫•t c·∫£ ·∫£nh v√† l·∫•y t·ªëi ƒëa 8 ·∫£nh
    var imagesToDisplayInGallery = allGalleryImageObjects
                                    .OrderByDescending(obj => (DateTime)obj.GetType().GetProperty("CreatedAt").GetValue(obj, null))
                                    .Take(8)
                                    .ToList();
}


            <div class="content-section" id="bo-suu-tap">
                <h3 class="section-title">B·ªô s∆∞u t·∫≠p ·∫£nh</h3>
                @if (imagesToDisplayInGallery.Any())
                {
        <div class="photo-grid" style="display: flex; flex-wrap: wrap; gap: 10px;">
            @foreach (var galleryItemObj in imagesToDisplayInGallery)
            {
                var imageUrl = (string)galleryItemObj.GetType().GetProperty("ImageUrl").GetValue(galleryItemObj, null);
                var altText = (string)galleryItemObj.GetType().GetProperty("AltText").GetValue(galleryItemObj, null);

                <div class="photo-item" style="flex: 1 1 150px; max-width: 200px;">
                    <img src="@(Url.Content(imageUrl))"
                         alt="@altText"
                         class="square-image" 
                         onclick="openLightbox(this.src)" />
                </div>
            }
        </div>
    }
    else
    {
        <p style="text-align: center; margin-top: 20px;">Ch∆∞a c√≥ ·∫£nh n√†o t·ª´ b√†i vi·∫øt ho·∫∑c ƒë√°nh gi√° c·ªßa b·∫°n ƒë·ªÉ hi·ªÉn th·ªã trong b·ªô s∆∞u t·∫≠p.</p>
    }
</div>


            <div class="content-section" id="bai-viet"> @* ID kh·ªõp v·ªõi href trong menu *@
                <h3 class="section-title">B√†i vi·∫øt c·ªßa t√¥i</h3>
                <div class="my-posts"> 
                    @if (Model.Posts == null || !Model.Posts.Any())
                            {
                                <div class="alert alert-info">
                                    B·∫°n ch∆∞a c√≥ b√†i vi·∫øt n√†o.
                                    <a asp-controller="Posts" asp-action="Create" class="alert-link">T·∫°o b√†i vi·∫øt m·ªõi ngay!</a>
                                </div>
                            }
                            else
                            {
                                <div class="row"> @* Use row/col for layout *@
                                    @foreach (var item in Model.Posts.OrderByDescending(p => p.CreatedAt)) @* Order by newest first *@
                                    {
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100 card-post-preview"> @* Added custom class for potential specific styling *@
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <span class="fw-bold">@item.Title</span>
                                                    <span class="badge @(item.Status == PostStatus.Approved ? "bg-success" :
                                                                                        item.Status == PostStatus.Pending ? "bg-warning text-dark" : "bg-danger")">
                                                        @(item.Status == PostStatus.Approved ? "ƒê√£ duy·ªát" :
                                                                            item.Status == PostStatus.Pending ? "Ch·ªù duy·ªát" : "T·ª´ ch·ªëi")
                                                    </span>
                                                </div>
                                                <div class="row g-0"> @* Use row g-0 inside card for image/text alignment *@
                                                    <div class="col-md-4">
                                                        <img src="@(item.ImageUrl ?? "/images/placeholder-post.png")" @* Fallback image *@
                                                            alt="@item.Title"
                                                            class="img-fluid rounded-start post-card-img w-100" /> @* Use rounded-start, w-100 *@
                                                    </div>
                                                    <div class="col-md-8">
                                                        <div class="card-body">
                                                            <p class="card-text small mb-1">
                                                                <strong>ƒê·ªãa ƒëi·ªÉm:</strong> @(item.Spot?.Name ?? "N/A")<br /> @* Null check for Spot *@
                                                                <strong>Lo·∫°i:</strong> @item.TypeOfPost<br />
                                                                <strong>Ng√†y t·∫°o:</strong> @item.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                                                            </p>
                                                            <p class="card-text small">
                                                                @if (!string.IsNullOrEmpty(item.Content))
                                                                {
                                                                    @(item.Content.Length > 80 ? item.Content.Substring(0, 80) + "..." : item.Content) @* Shorter preview *@
                                                                }
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer text-center">
                                                    @* Update asp-controller if your posts controller is named differently *@
                                                    <a asp-controller="Posts" asp-action="Details" asp-route-id="@item.PostId" class="btn btn-sm btn-outline-info">Chi ti·∫øt</a>
                                                    <a asp-controller="Posts" asp-action="Edit" asp-route-id="@item.PostId" class="btn btn-sm btn-outline-primary">S·ª≠a</a>
                                                    <a asp-controller="Posts" asp-action="Delete" asp-route-id="@item.PostId" class="btn btn-sm btn-outline-danger">X√≥a</a>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>

            <div class="content-section" id="danh-gia">
                <h3 class="section-title">ƒê√°nh gi√° c·ªßa t√¥i</h3>
                <div class="blog-list">
                @if (Model?.Reviews != null && Model.Reviews.Any())
                     {
                        @foreach (var review in Model.Reviews)
                     {
                               <div class="blog-item">
                            
                            <img src="@(Url.Content(review.ImageUrl))" 
                         alt="@review?.Spot?.Name" style="width: 100px; height: 100px;">
                            <div class="blog-content">
                            <div class="blog-title">@review?.Rating</div>
                            <div class="blog-preview">@review?.Comment?.Substring(0, Math.Min(review.Comment.Length, 100))...</div>
                            <div class="blog-meta">
                            <span>ƒêƒÉng ng√†y: @review?.CreatedAt.ToString("dd/MM/yyyy")</span>
                               </div>
                                 </div>
                                     </div>
                       }
                    }
                else
                  {
                          <div class="alert alert-info text-center">B·∫°n ch∆∞a vi·∫øt ƒë√°nh gi√° n√†o.</div>
                    }
                </div>
            </div>



            @* Ph·∫ßn b√¨nh lu·∫≠n c·ªßa t√¥i *@
                 <div class="content-section" id="binh-luan">
    <h3 class="section-title">
        <i class="bi bi-chat-dots-fill me-2"></i>
        B√¨nh lu·∫≠n c·ªßa t√¥i (@Model.PostComments.Count)
    </h3>
    <div class="blog-list">
        @if (Model.PostComments != null && Model.PostComments.Any())
        {
            foreach (var comment in Model.PostComments.OrderByDescending(c => c.CreatedAt))
            {
                <div class="blog-item">
                    <div class="blog-content">
                        <div class="blog-title">
                            @Html.Raw(comment.Content)
                        </div>
                        <div class="blog-meta">
                            <span><i class="bi bi-clock me-1"></i>@comment.CreatedAt.ToString("dd/MM/yyyy HH:mm")</span>

                            @if (comment.Post != null)
                            {
                                <span class="ms-3">
                                    <i class="bi bi-file-text me-1"></i>Trong b√†i vi·∫øt:
                                    <a href="@Url.Action("Details", "Posts", new { id = comment.PostId })" title="@comment.Post.Title">
                                        @(comment.Post.Title != null && comment.Post.Title.Length > 50
                                            ? comment.Post.Title.Substring(0, 50) + "..."
                                            : comment.Post.Title ?? "Kh√¥ng c√≥ ti√™u ƒë·ªÅ")
                                    </a>
                                </span>
                            }
                            else
                            {
                                <span class="ms-3 text-warning">
                                    <i class="bi bi-exclamation-triangle me-1"></i>B√†i vi·∫øt li√™n quan kh√¥ng c√≤n t·ªìn t·∫°i
                                </span>
                            }
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="alert alert-info text-center">B·∫°n ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</div>
        }
    </div>
</div>
                    


            <div class="content-section" id="dia-diem-yeu-thich">
                <h3 class="section-title">ƒê·ªãa ƒëi·ªÉm y√™u th√≠ch</h3>
                <div class="travel-inspiration">
                    @foreach (var favorite in Model.SpotFavorites.Take(3))
                    {
                        <div class="inspiration-card">
                            <img src="@favorite.Spot.ImageUrl" alt="@favorite.Spot.Name">
                            <div class="inspiration-content">
                                <div class="inspiration-title">@favorite.Spot.Name</div>
                                <div class="inspiration-description">@favorite.Spot.Description</div>
                                <div class="inspiration-meta">
                                    @* <span>Th·ªùi gian t·ªët nh·∫•t: @favorite.Spot.BestTimeToVisit</span> *@
                                    <span>ƒê√£ l∆∞u</span>
                                </div>
                            </div>
                        </div>
                    }
                    @if (Model.SpotFavorites.Count == 0)
                    {
                        @* <div class="alert alert-info text-center">B·∫°n ch∆∞a c√≥ ƒë·ªãa ƒëi·ªÉm y√™u th√≠ch.</div> *@
                        <div class="empty-state-favorites text-center p-4">
                            <div class="empty-icon mb-3" style="font-size: 3rem; color: #6c757d;">üó∫Ô∏è</div> @* Ho·∫∑c üß≥ *@
                            <h4>B·ªô s∆∞u t·∫≠p y√™u th√≠ch c·ªßa b·∫°n ƒëang ch·ªù!</h4>
                            <p class="text-muted">
                                T√¨m th·∫•y m·ªôt n∆°i b·∫°n mu·ªën ƒë·∫øn? Ch·ªâ c·∫ßn nh·∫•n ‚ù§Ô∏è ƒë·ªÉ l∆∞u l·∫°i ƒë√¢y v√† d·ªÖ d√†ng t√¨m th·∫•y sau n√†y.
                            </p>
                            <a asp-controller="TouristSpots" asp-action="Index" class="btn btn-outline-primary mt-3" style="border-radius: 20px; padding: 10px 25px;">
                                B·∫Øt ƒë·∫ßu kh√°m ph√°
                            </a>
                        </div>
                    }
                </div>
            </div>

            <div class="content-section" id="bai-viet-yeu-thich">
                <h3 class="section-title">B√†i vi·∫øt y√™u th√≠ch</h3>
                <div class="favorite-posts">
                    @foreach (var favorite in Model.PostFavorites.Take(4))
                    {
                        <div class="favorite-post-card">
                            <img src="@favorite.Post.ImageUrl" alt="@favorite.Post.Title">
                            <div class="favorite-post-content">
                                <div class="favorite-post-title">@favorite.Post.Title</div>
                                <div class="favorite-post-author">
                                    <img src="@favorite.Post.User.AvatarUrl" alt="@favorite.Post.User.FullName">
                                    <div class="favorite-post-author-name">@favorite.Post.User.FullName ‚Ä¢ @favorite.Post.CreatedAt.ToString("dd/MM/yyyy")</div>
                                </div>
                            </div>
                        </div>
                    }
                    @if (Model.PostFavorites.Count == 0)
                    {
                        <div class="alert alert-info text-center">B·∫°n ch∆∞a c√≥ b√†i vi·∫øt y√™u th√≠ch.</div>
                    }
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Lightbox for images -->
<div id="lightbox" class="lightbox">
    <span class="close-lightbox">&times;</span>
    <img class="lightbox-content" id="lightbox-img">
    <div class="lightbox-caption"></div>
</div>

@section Scripts {
<script>
    // JavaScript ƒë·ªÉ x·ª≠ l√Ω cu·ªôn trang v√† hi·ªáu ·ª©ng m∆∞·ª£t m√†
    document.addEventListener('DOMContentLoaded', function () {
        // Th√™m hi·ªáu ·ª©ng cu·ªôn m∆∞·ª£t m√† cho c√°c li√™n k·∫øt trong menu
        const menuItems = document.querySelectorAll('.profile-menu a');
        menuItems.forEach(item => {
            item.addEventListener('click', function (e) {
                // Ng·ª´ng h√†nh ƒë·ªông m·∫∑c ƒë·ªãnh ƒë·ªÉ ngƒÉn trang t·ª± ƒë·ªông cu·ªôn
                e.preventDefault();

                // L·∫•y m·ª•c ti√™u cu·ªôn v√† cu·ªôn ƒë·∫øn ƒë√≥
                const targetId = this.getAttribute('href').substring(1); // Lo·∫°i b·ªè d·∫•u # t·ª´ href
                const targetElement = document.getElementById(targetId);
                window.scrollTo({
                    top: targetElement.offsetTop - 50, // ƒê·ªÉ cho ph·∫ßn tr√™n c·ªßa m·ª•c cu·ªôn c√°ch m·ªôt ch√∫t
                    behavior: 'smooth'
                });

                // Th√™m hi·ªáu ·ª©ng active cho menu
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Th√™m hi·ªáu ·ª©ng active cho c√°c tab
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // X√≥a l·ªõp 'active' kh·ªèi t·∫•t c·∫£ c√°c tab v√† tab content
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Th√™m l·ªõp 'active' v√†o tab ƒë√£ nh·∫•n v√† ph·∫ßn n·ªôi dung t∆∞∆°ng ·ª©ng
                tab.classList.add('active');
                const activeTab = tab.getAttribute('data-tab');
                document.getElementById(`${activeTab}-tab`).classList.add('active');
            });
        });
    });
    function enablePhoneEdit() {
        const input = document.getElementById('PhoneNumberInput');
        input.classList.remove('d-none');
        input.focus();
    }
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function(e) {
                document.getElementById('avatarPreview').src = e.target.result;
            }
            
            reader.readAsDataURL(input.files[0]);
        }
    }
            // Open lightbox when clicking on image
        function openLightbox(src) {
                var lightbox = document.getElementById('lightbox');
    var lightboxImg = document.getElementById('lightbox-img');
            document.getElementById('lightbox').style.display = 'flex';
            document.getElementById('lightbox-img').src = src;
        }
        document.addEventListener('click', function(e) {
    var lightbox = document.getElementById('lightbox');
    if (e.target.id === 'lightbox') {
        lightbox.style.display = 'none';
    }
});
// Handle drag and drop
        const avatarContainer = document.querySelector('.avatar-container');
        
        avatarContainer.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        });
        
        avatarContainer.addEventListener('dragleave', function() {
            this.classList.remove('drag-over');
        });
        
        avatarContainer.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                document.getElementById('avatarFile').files = e.dataTransfer.files;
                handleFileChange(document.getElementById('avatarFile'));
            }
        });
        
        // Handle file selection
        function handleFileChange(input) {
            if (input.files && input.files[0]) {
                // Show preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatarPreview').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
                
                // Show uploading message
                document.getElementById('uploadingMessage').classList.remove('d-none');
                
                // Submit the form automatically
                setTimeout(() => {
                    document.getElementById('avatarForm').submit();
                }, 500);
            }
        }
        
        // Add tooltip
        const cameraButton = document.querySelector('.avatar-container .position-absolute');
        cameraButton.setAttribute('title', 'Nh·∫•n ƒë·ªÉ ch·ªçn ·∫£nh ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y');
        
        // Initialize Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });
</script>
}
<style>
    .avatar-container:hover .avatar-overlay {
        opacity: 1;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .avatar-container.drag-over:after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    
    .hover-bg:hover {
        background-color: #f0f0f0 !important;
        transition: background-color 0.2s ease;
    }
    
    .cursor-pointer {
        cursor: pointer;
    }
    
    .object-fit-cover {
        object-fit: cover;
    }
    .square-image {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    border-radius: 4px;
    border: 1px solid #ddd;
    }
    #lightbox {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

#lightbox img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 4px;
}
</style>