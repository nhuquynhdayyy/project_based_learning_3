@* @model TourismWeb.Models.User
@section Styles {
    <link rel="stylesheet" href="~/css/userprofile.css" asp-append-version="true" />
}

@{
    ViewData["Title"] = "Trang cá nhân user";
}

<main>
    <div class="profile-container">
        <div class="profile-sidebar">
            <img src="@Model.AvatarUrl" alt="@Model.FullName">
            <h2 class="profile-name">@Model.FullName</h2>

            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-number">@Model.Posts.Count</div>
                    <div class="stat-label">Bài viết</div>
                </div>
            </div>

            <ul class="profile-menu">
                <li><a href="#thongtin-tai-khoan">Hồ sơ</a></li>
                <li><a href="#bo-suu-tap">Bộ sưu tập ảnh</a></li>
                <li><a href="#dia-diem-yeu-thich">Địa điểm yêu thích</a></li>
                <li><a href="#danh-gia">Đánh giá của tôi</a></li>
                <li><a href="#bai-viet-yeu-thich">Bài viết yêu thích</a></li>
            </ul>
        </div>

        <div class="profile-content">
            <div class="profile-tabs">
                <div class="tab active" data-tab="account">Thông tin tài khoản</div>
                <div class="tab" data-tab="security">Mật khẩu & Bảo mật</div>
            </div>

            <div id="account-tab" class="tab-content active">
                <div class="content-section" id="thongtin-tai-khoan">
                    <h3 class="section-title">Dữ liệu cá nhân</h3>

                    <div class="form-group">
                        <label class="form-label">Tên đầy đủ</label>
                        <input type="text" class="form-input" value="@Model.FullName">
                        <p class="form-hint">Tên trong hồ sơ được rút ngắn từ họ tên của bạn.</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Giới tính</label>
                            <select class="form-select">
                                <option value="female" selected>Female</option>
                                <option value="male">Male</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ngày sinh</label>
                            <div class="date-selects">
                                @{
                                    var birthDate = Model.DateOfBirth.HasValue ? Model.DateOfBirth.Value : DateTime.Now;
                                    var day = birthDate.Day;
                                    var month = birthDate.Month;
                                    var year = birthDate.Year;
                                }
                                <select class="form-select">
                                    @for (int i = 1; i <= 31; i++)
                                    {
                                        <option value="@i" selected="@(day == i)">@i</option>
                                    }
                                </select>

                                <select class="form-select">
                                    @for (int i = 1; i <= 12; i++)
                                    {
                                        <option value="@i" selected="@(month == i)">Tháng @i</option>
                                    }
                                </select>
                                <select class="form-select">
                                    @{
                                        int currentYear = DateTime.Now.Year;
                                        for (int i = currentYear; i >= currentYear - 100; i--)
                                        {
                                            <option value="@i" selected="@(year == i)">@i</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Thành phố cư trú</label>
                        <input type="text" class="form-input" placeholder="Thành phố cư trú">
                    </div>

                    <div class="button-group">
                        <button class="btn btn-outline">Có lẽ để sau</button>
                        <button class="btn btn-primary">Lưu</button>
                    </div>
                </div>

                <div class="content-section">
                    <h3 class="section-title">Email</h3>

                    <div class="email-item">
                        <div>
                            <p class="email-title">@Model.Email</p>
                        </div>
                        <span class="notification-badge">Nơi nhận thông báo</span>
                    </div>
                    @if (string.IsNullOrEmpty(Model.Email))
                    {
                        <div class="button-group">
                            <button class="btn btn-outline">
                                <i class="icon-plus"></i>
                                Thêm email
                            </button>
                        </div>        
                    }
                </div>

                <div class="content-section">
                    <h3 class="section-title">Số di động</h3>

                    @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                    {
                        <div class="email-item">
                            <div>
                                <p class="email-title">@Model.PhoneNumber</p>
                            </div>
                        </div>
                    }

                    <div class="button-group">
                        <button class="btn btn-outline">
                            <i class="icon-plus"></i>
                            Thêm số di động
                        </button>
                    </div>
                </div>
            </div>

            <div id="security-tab" class="tab-content">
                <div class="content-section" id="cai-dat">
                    <h3 class="section-title">Mật khẩu & Bảo mật</h3>
                    <p class="card-description">Quản lý mật khẩu và các tùy chọn bảo mật cho tài khoản của bạn</p>

                    <div class="form-group">
                        <label class="form-label">Mật khẩu hiện tại</label>
                        <input type="password" class="form-input">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Mật khẩu mới</label>
                        <input type="password" class="form-input">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Xác nhận mật khẩu mới</label>
                        <input type="password" class="form-input">
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary">Cập nhật mật khẩu</button>
                    </div>
                </div>

                <div class="content-section">
                    <h3 class="section-title">Xác thực hai yếu tố</h3>
                    <p class="card-description">Tăng cường bảo mật cho tài khoản của bạn</p>

                    <div class="toggle-item">
                        <div>
                            <p class="toggle-title">Xác thực qua SMS</p>
                            <p class="toggle-description">Nhận mã xác thực qua tin nhắn SMS</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="toggle-item">
                        <div>
                            <p class="toggle-title">Xác thực qua ứng dụng</p>
                            <p class="toggle-description">Sử dụng ứng dụng xác thực như Google Authenticator</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="content-section" id="bo-suu-tap">
                <h3 class="section-title">Bộ sưu tập ảnh</h3>
                <div class="photo-grid">
                    @foreach (var image in Model.SpotImages.Take(8))
                    {
                        <div class="photo-item">
                            <img src="@image.ImageUrl" alt="Hình ảnh du lịch">
                        </div>
                    }
                    @if (Model.SpotImages.Count == 0)
                    {
                        <div class="photo-item">
                            <img src="/images/nguhanhson.png" alt="Hình ảnh du lịch">
                        </div>
                        <div class="photo-item">
                            <img src="/images/nhatrang.jpg" alt="Hình ảnh du lịch">
                        </div>
                        <div class="photo-item">
                            <img src="/images/sanho.jpg" alt="Hình ảnh du lịch">
                        </div>
                        <div class="photo-item">
                            <img src="/images/sontra.jpg" alt="Hình ảnh du lịch">
                        </div>
                    }
                </div>
            </div>

            <div class="content-section" id="dia-diem-yeu-thich">
                <h3 class="section-title">Địa điểm yêu thích</h3>
                <div class="travel-inspiration">
                    @foreach (var favorite in Model.SpotFavorites.Take(3))
                    {
                        <div class="inspiration-card">
                            <img src="@favorite.Spot.ImageUrl" alt="@favorite.Spot.Name">
                            <div class="inspiration-content">
                                <div class="inspiration-title">@favorite.Spot.Name</div>
                                <div class="inspiration-description">@favorite.Spot.Description</div>
                                <div class="inspiration-meta">
                                    <span>Thời gian tốt nhất: favorite.Spot.BestTimeToVisit</span>
                                    <span>Đã lưu</span>
                                </div>
                            </div>
                        </div>
                    }
                    @if (Model.SpotFavorites.Count == 0)
                    {
                        <div class="inspiration-card">
                            <img src="/images/hue.jpg" alt="Huế, Thừa Thiên Huế">
                            <div class="inspiration-content">
                                <div class="inspiration-title">Huế, Thừa Thiên Huế</div>
                                <div class="inspiration-description">Cố đô với hệ thống di tích lăng tẩm, hoàng thành và
                                    ẩm thực cung đình độc đáo.</div>
                                <div class="inspiration-meta">
                                    <span>Thời gian tốt nhất: Tháng 3-8</span>
                                    <span>Đã lưu</span>
                                </div>
                            </div>
                        </div>
                        <div class="inspiration-card">
                            <img src="/images/danang3.jpg" alt="Đà Nẵng">
                            <div class="inspiration-content">
                                <div class="inspiration-title">Đà Nẵng</div>
                                <div class="inspiration-description">Thành phố biển hiện đại với Bà Nà Hills, Ngũ Hành
                                    Sơn và bãi biển Mỹ Khê tuyệt đẹp.</div>
                                <div class="inspiration-meta">
                                    <span>Thời gian tốt nhất: Tháng 2-8</span>
                                    <span>Đã lưu</span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="content-section" id="danh-gia">
                <h3 class="section-title">Đánh giá của tôi</h3>
                <div class="blog-list">
                    @foreach (var review in Model.Reviews.Take(3))
                    {
                        <div class="blog-item">
                            <img src="@review.Spot.ImageUrl" alt="@review.Spot.Name">
                            <div class="blog-content">
                                <div class="blog-title">@review.Rating</div>
                                <div class="blog-preview">@review.Comment.Substring(0, Math.Min(review.Comment.Length, 100))...</div>
                                <div class="blog-meta">
                                    <span>Đăng ngày: @review.CreatedAt.ToString("dd/MM/yyyy")</span>
                                    <span> review.ViewCount lượt xem</span>
                                </div>
                            </div>
                        </div>
                    }
                    @if (Model.Reviews.Count == 0)
                    {
                        <div class="blog-item">
                            <img src="/images/hoian.jpg" alt="Ẩm thực Hội An">
                            <div class="blog-content">
                                <div class="blog-title">Top 10 món ăn nhất định phải thử khi đến Hội An</div>
                                <div class="blog-preview">Từ Cao lầu đến Bánh mì Phượng, hãy cùng khám phá những món ăn
                                    tuyệt vời nhất của phố cổ...</div>
                                <div class="blog-meta">
                                    <span>Đăng ngày: 15/12/2024</span>
                                    <span>325 lượt xem</span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="content-section" id="bai-viet-yeu-thich">
                <h3 class="section-title">Bài viết yêu thích</h3>
                <div class="favorite-posts">
                    @foreach (var favorite in Model.PostFavorites.Take(4))
                    {
                        <div class="favorite-post-card">
                            <img src="@favorite.Post.ImageUrl" alt="@favorite.Post.Title">
                            <div class="favorite-post-content">
                                <div class="favorite-post-title">@favorite.Post.Title</div>
                                <div class="favorite-post-author">
                                    <img src="@favorite.Post.User.AvatarUrl" alt="@favorite.Post.User.FullName">
                                    <div class="favorite-post-author-name">@favorite.Post.User.FullName • @favorite.Post.CreatedAt.ToString("dd/MM/yyyy")</div>
                                </div>
                            </div>
                        </div>
                    }
                    @if (Model.PostFavorites.Count == 0)
                    {
                        <div class="favorite-post-card">
                            <img src="/images/hoian2.jpg" alt="Điểm tham quan Hội An">
                            <div class="favorite-post-content">
                                <div class="favorite-post-title">Top 10 điểm tham quan không thể bỏ lỡ ở Hội An</div>
                                <div class="favorite-post-author">
                                    <img src="/images/avatar3.png" alt="Lê Thị B">
                                    <div class="favorite-post-author-name">Lê Thị B • 18/01/2025</div>
                                </div>
                            </div>
                        </div>
                        <div class="favorite-post-card">
                            <img src="/images/haunuong.jpg" alt="Ẩm thực đường phố miền Trung">
                            <div class="favorite-post-content">
                                <div class="favorite-post-title">Ẩm thực đường phố miền Trung: Hành trình khám phá hương
                                    vị cay nồng</div>
                                <div class="favorite-post-author">
                                    <img src="/images/avatar3.png" alt="Trần Văn C">
                                    <div class="favorite-post-author-name">Trần Văn C • 05/03/2025</div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    // JavaScript để xử lý cuộn trang và hiệu ứng mượt mà
    document.addEventListener('DOMContentLoaded', function () {
        // Thêm hiệu ứng cuộn mượt mà cho các liên kết trong menu
        const menuItems = document.querySelectorAll('.profile-menu a');
        menuItems.forEach(item => {
            item.addEventListener('click', function (e) {
                // Ngừng hành động mặc định để ngăn trang tự động cuộn
                e.preventDefault();

                // Lấy mục tiêu cuộn và cuộn đến đó
                const targetId = this.getAttribute('href').substring(1); // Loại bỏ dấu # từ href
                const targetElement = document.getElementById(targetId);
                window.scrollTo({
                    top: targetElement.offsetTop - 50, // Để cho phần trên của mục cuộn cách một chút
                    behavior: 'smooth'
                });

                // Thêm hiệu ứng active cho menu
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Thêm hiệu ứng active cho các tab
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Xóa lớp 'active' khỏi tất cả các tab và tab content
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Thêm lớp 'active' vào tab đã nhấn và phần nội dung tương ứng
                tab.classList.add('active');
                const activeTab = tab.getAttribute('data-tab');
                document.getElementById(`${activeTab}-tab`).classList.add('active');
            });
        });
    });
</script> *@
@model TourismWeb.Models.User
@using TourismWeb.Models 
@section Styles {
    <link rel="stylesheet" href="~/css/userprofile.css" asp-append-version="true" />
}

@{
    ViewData["Title"] = "Trang cá nhân user";
    var successMessage = TempData["SuccessMessage"] as string;
    var errorMessage = TempData["ErrorMessage"] as string;

}

@if (!string.IsNullOrEmpty(successMessage))
{
    <div class="alert alert-success">@successMessage</div>
}
@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}


<main>
    <div class="profile-container">
        <div class="profile-sidebar">
    <div class="card-body p-4">
       <div class="text-center mb-4">
            <div class="avatar-container position-relative mx-auto" style="width: 150px; height: 150px;">
                <!-- Current avatar display -->
                <div class="rounded-circle overflow-hidden border border-3 border-light shadow-sm" style="width: 150px; height: 150px;">
                    <img src="@Model.AvatarUrl" alt="@Model.FullName" class="w-100 h-100 object-fit-cover" id="avatarPreview">
                </div>
                
                <!-- Hover overlay -->
                <div class="avatar-overlay position-absolute top-0 start-0 w-100 h-100 rounded-circle d-flex align-items-center justify-content-center" 
                     style="background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.2s ease;"
                     onclick="document.getElementById('avatarFile').click()">
                    <i class="bi bi-camera-fill text-white fs-3"></i>
                </div>
            </div>
        </div>

        <form asp-controller="Profile" asp-action="UploadAvatar" method="post" enctype="multipart/form-data">
            <div class="mb-3">
                <!-- Smaller, more compact upload area -->
                <div class="upload-area border border-1 border-dashed rounded-3 py-2 px-3 text-center bg-light cursor-pointer hover-bg mx-auto" 
                     style="max-width: 220px;"
                     onclick="document.getElementById('avatarFile').click()">
                    <i class="bi bi-upload text-secondary fs-5"></i>
                    <p class="text-secondary mb-0 small">
                        <span class="fw-medium">Nhấn để chọn ảnh</span> hoặc kéo thả vào đây
                    </p>
                </div>
                <input type="file" id="avatarFile" name="avatarFile" accept="image/*" class="d-none" 
                       onchange="previewImage(this)">
            </div>
            
            <button type="submit" class="btn btn-primary w-100">Cập nhật ảnh đại diện</button>
        </form>
    </div>

            <h2 class="profile-name">@Model.FullName</h2>

            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-number">@Model.Posts.Count</div>
                    <div class="stat-label">Bài viết</div>
                </div>
            </div>

            <ul class="profile-menu">
                <li><a href="#thongtin-tai-khoan">Hồ sơ</a></li>
                <li><a href="#bo-suu-tap">Bộ sưu tập ảnh</a></li>
                <li><a href="#bai-viet">Bài viết của tôi</a></li>
                <li><a href="#danh-gia">Đánh giá của tôi</a></li>
                <li><a href="#binh-luan">Bình luận của tôi</a></li>
                <li><a href="#dia-diem-yeu-thich">Địa điểm yêu thích</a></li>
                <li><a href="#bai-viet-yeu-thich">Bài viết yêu thích</a></li>
            </ul>
        </div>

        <div class="profile-content">
            @if (!string.IsNullOrEmpty(successMessage))
             {
                 <div class="alert alert-success" role="alert">@successMessage</div>
             }
             @if (!string.IsNullOrEmpty(errorMessage))
             {
                 <div class="alert alert-danger" role="alert">@errorMessage</div>
             }
             @* Hiển thị tóm tắt lỗi validation từ ModelState *@
             <div asp-validation-summary="ModelOnly" class="text-danger alert alert-danger"></div>
            <div class="profile-tabs">
                <div class="tab active" data-tab="account">Thông tin tài khoản</div>
                <div class="tab" data-tab="security">Mật khẩu & Bảo mật</div>
            </div>

            <div id="account-tab" class="tab-content active">
    <form asp-controller="Profile" asp-action="UpdateProfile" method="post">
        @Html.AntiForgeryToken()

        <div class="content-section" id="thongtin-tai-khoan">
            <h3 class="section-title">Dữ liệu cá nhân</h3>
            <div class="form-group">
                <label class="form-label" for="FullNameInput">Tên đầy đủ</label>
                <input type="text" id="FullNameInput" name="FullName" class="form-input form-control" value="@Model.FullName">
                <span class="text-danger">@Html.ValidationMessage("FullName")</span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Ngày sinh</label>
                    <div class="date-selects">
                        @{
                            var birthDate = Model.DateOfBirth;
                            var day = birthDate?.Day ?? 0;
                            var month = birthDate?.Month ?? 0;
                            var year = birthDate?.Year ?? 0;

                            if (ViewData.ModelState.TryGetValue("BirthDay", out var dayState) && dayState.AttemptedValue != null)
                                int.TryParse(dayState.AttemptedValue, out day);
                            if (ViewData.ModelState.TryGetValue("BirthMonth", out var monthState) && monthState.AttemptedValue != null)
                                int.TryParse(monthState.AttemptedValue, out month);
                            if (ViewData.ModelState.TryGetValue("BirthYear", out var yearState) && yearState.AttemptedValue != null)
                                int.TryParse(yearState.AttemptedValue, out year);
                        }

                        <select class="form-select" name="BirthDay">
                            <option value="0" selected="@(day == 0)">Ngày</option>
                            @for (int i = 1; i <= 31; i++)
                            {
                                <option value="@i" selected="@(day == i)">@i</option>
                            }
                        </select>
                        <select class="form-select" name="BirthMonth">
                            <option value="0" selected="@(month == 0)">Tháng</option>
                            @for (int i = 1; i <= 12; i++)
                            {
                                <option value="@i" selected="@(month == i)">Tháng @i</option>
                            }
                        </select>
                        <select class="form-select" name="BirthYear">
                            <option value="0" selected="@(year == 0)">Năm</option>
                            @{
                                int currentYear = DateTime.Now.Year;
                                for (int i = currentYear; i >= currentYear - 100; i--)
                                {
                                    <option value="@i" selected="@(year == i)">@i</option>
                                }
                            }
                        </select>
                    </div>
                    <span class="text-danger">@Html.ValidationMessage("DateOfBirth")</span>
                </div>
            </div>

            <div class="button-group mt-4">
                <button type="reset" class="btn btn-outline">Hủy thay đổi</button>
                <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
            </div>
        </div>

        <div class="content-section">
            <h3 class="section-title">Email</h3>
            <div class="email-item">
                <p class="email-title" style="margin: 0;">@Model.Email</p>
                <span class="notification-badge">Nơi nhận thông báo</span>
            </div>
            @if (string.IsNullOrEmpty(Model.Email))
            {
                <div class="button-group">
                    <button class="btn btn-outline"><i class="icon-plus"></i> Thêm email</button>
                </div>
            }
        </div>

        <div class="content-section"> 
                        <h3 class="section-title">Số di động</h3>
                         <div class="form-group">
                            <label class="form-label" for="PhoneNumberInput">Số di động</label>
                            <input type="tel" id="PhoneNumberInput" name="PhoneNumber" class="form-input form-control" value="@Model.PhoneNumber">
                            <span class="text-danger">@Html.ValidationMessage("PhoneNumber")</span>
                            
                            <div class="button-group mt-4"></div>
                <button type="reset" class="btn btn-outline">Hủy thay đổi</button>
                <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
            </div>
        </div>
    </form>
</div>


                    @* @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                    {
                        <div class="email-item">
                            <div>
                                <p class="email-title">@Model.PhoneNumber</p>
                            </div>
                        </div>
                    }

                    <div class="button-group">
                        <button class="btn btn-outline">
                            <i class="icon-plus"></i>
                            Thêm số di động
                        </button>
                    </div>
                </div>
            </div> *@

            <div id="security-tab" class="tab-content @(ViewData["ActiveTab"] as string == "security" ? "active" : "")">
                <form asp-controller="Profile" asp-action="UpdatePassword" method="post">
                     @Html.AntiForgeryToken()

                     <div class="content-section" id="cai-dat">
                        <h3 class="section-title">Mật khẩu & Bảo mật</h3>
                        <p class="card-description">Quản lý mật khẩu và các tùy chọn bảo mật cho tài khoản của bạn</p>
                         @* Hiển thị lỗi chung từ ModelState nếu có *@
                         <div asp-validation-summary="ModelOnly" class="text-danger alert alert-danger"></div>

                        <div class="form-group">
                            <label class="form-label" for="CurrentPasswordInput">Mật khẩu hiện tại</label>
                            <input type="password" id="CurrentPasswordInput" name="CurrentPassword" class="form-input form-control" required>
                            <span class="text-danger">@Html.ValidationMessage("CurrentPassword")</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="NewPasswordInput">Mật khẩu mới</label>
                            <input type="password" id="NewPasswordInput" name="NewPassword" class="form-input form-control" required>
                            <span class="text-danger">@Html.ValidationMessage("NewPassword")</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="ConfirmPasswordInput">Xác nhận mật khẩu mới</label>
                            <input type="password" id="ConfirmPasswordInput" name="ConfirmPassword" class="form-input form-control" required>
                            <span class="text-danger">@Html.ValidationMessage("ConfirmPassword")</span>
                        </div>

                        <div class="button-group mt-3">
                            <button type="submit" class="btn btn-primary">Cập nhật mật khẩu</button>
                        </div>
                    </div>
                </form>
            </div>

                @* <div class="content-section">
                    <h3 class="section-title">Xác thực hai yếu tố</h3>
                    <p class="card-description">Tăng cường bảo mật cho tài khoản của bạn</p>

                    <div class="toggle-item">
                        <div>
                            <p class="toggle-title">Xác thực qua SMS</p>
                            <p class="toggle-description">Nhận mã xác thực qua tin nhắn SMS</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="toggle-item">
                        <div>
                            <p class="toggle-title">Xác thực qua ứng dụng</p>
                            <p class="toggle-description">Sử dụng ứng dụng xác thực như Google Authenticator</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div> *@
            

            <div class="content-section" id="bo-suu-tap">
                <h3 class="section-title">Bộ sưu tập ảnh</h3>
                <div class="photo-grid">
                    @foreach (var image in Model.SpotImages.Take(8))
                    {
                        <div class="photo-item">
                            <img src="@image.ImageUrl" alt="Hình ảnh du lịch">
                        </div>
                    }
                    @if (Model.SpotImages.Count == 0)
                    {
                        <div class="photo-item">
                            <img src="/images/nguhanhson.png" alt="Hình ảnh du lịch">
                        </div>
                        <div class="photo-item">
                            <img src="/images/nhatrang.jpg" alt="Hình ảnh du lịch">
                        </div>
                        <div class="photo-item">
                            <img src="/images/sanho.jpg" alt="Hình ảnh du lịch">
                        </div>
                        <div class="photo-item">
                            <img src="/images/sontra.jpg" alt="Hình ảnh du lịch">
                        </div>
                    }
                </div>
            </div>

            <div class="content-section" id="bai-viet"> @* ID khớp với href trong menu *@
                <h3 class="section-title">Bài viết của tôi</h3>
                <div class="my-posts"> 
                    @if (Model.Posts == null || !Model.Posts.Any())
                            {
                                <div class="alert alert-info">
                                    Bạn chưa có bài viết nào.
                                    <a asp-controller="Posts" asp-action="Create" class="alert-link">Tạo bài viết mới ngay!</a>
                                </div>
                            }
                            else
                            {
                                <div class="row"> @* Use row/col for layout *@
                                    @foreach (var item in Model.Posts.OrderByDescending(p => p.CreatedAt)) @* Order by newest first *@
                                    {
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100 card-post-preview"> @* Added custom class for potential specific styling *@
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <span class="fw-bold">@item.Title</span>
                                                    <span class="badge @(item.Status == PostStatus.Approved ? "bg-success" :
                                                                                        item.Status == PostStatus.Pending ? "bg-warning text-dark" : "bg-danger")">
                                                        @(item.Status == PostStatus.Approved ? "Đã duyệt" :
                                                                            item.Status == PostStatus.Pending ? "Chờ duyệt" : "Từ chối")
                                                    </span>
                                                </div>
                                                <div class="row g-0"> @* Use row g-0 inside card for image/text alignment *@
                                                    <div class="col-md-4">
                                                        <img src="@(item.ImageUrl ?? "/images/placeholder-post.png")" @* Fallback image *@
                                                            alt="@item.Title"
                                                            class="img-fluid rounded-start post-card-img w-100" /> @* Use rounded-start, w-100 *@
                                                    </div>
                                                    <div class="col-md-8">
                                                        <div class="card-body">
                                                            <p class="card-text small mb-1">
                                                                <strong>Địa điểm:</strong> @(item.Spot?.Name ?? "N/A")<br /> @* Null check for Spot *@
                                                                <strong>Loại:</strong> @item.TypeOfPost<br />
                                                                <strong>Ngày tạo:</strong> @item.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                                                            </p>
                                                            <p class="card-text small">
                                                                @if (!string.IsNullOrEmpty(item.Content))
                                                                {
                                                                    @(item.Content.Length > 80 ? item.Content.Substring(0, 80) + "..." : item.Content) @* Shorter preview *@
                                                                }
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer text-center">
                                                    @* Update asp-controller if your posts controller is named differently *@
                                                    <a asp-controller="Posts" asp-action="Details" asp-route-id="@item.PostId" class="btn btn-sm btn-outline-info">Chi tiết</a>
                                                    <a asp-controller="Posts" asp-action="Edit" asp-route-id="@item.PostId" class="btn btn-sm btn-outline-primary">Sửa</a>
                                                    <a asp-controller="Posts" asp-action="Delete" asp-route-id="@item.PostId" class="btn btn-sm btn-outline-danger">Xóa</a>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>

            <div class="content-section" id="danh-gia">
                <h3 class="section-title">Đánh giá của tôi</h3>
                <div class="blog-list">
                    @foreach (var review in Model.Reviews.Take(3))
                    {
                        <div class="blog-item">
                            <img src="@review.Spot.ImageUrl" alt="@review.Spot.Name">
                            <div class="blog-content">
                                <div class="blog-title">@review.Rating</div>
                                <div class="blog-preview">@review.Comment.Substring(0, Math.Min(review.Comment.Length, 100))...</div>
                                <div class="blog-meta">
                                    <span>Đăng ngày: @review.CreatedAt.ToString("dd/MM/yyyy")</span>
                                    @* <span>@review.ViewCount lượt xem</span> *@
                                </div>
                            </div>
                        </div>
                    }
                    @if (Model.Reviews.Count == 0)
                    {
                        <div class="alert alert-info text-center">Bạn chưa viết đánh giá nào.</div>
                    }
                </div>
            </div>

            @* Phần bình luận của tôi *@
                 <div class="content-section" id="binh-luan">
    <h3 class="section-title">
        <i class="bi bi-chat-dots-fill me-2"></i>
        Bình luận của tôi (@Model.PostComments.Count)
    </h3>
    <div class="blog-list">
        @if (Model.PostComments != null && Model.PostComments.Any())
        {
            foreach (var comment in Model.PostComments.OrderByDescending(c => c.CreatedAt))
            {
                <div class="blog-item">
                    <div class="blog-content">
                        <div class="blog-title">
                            @Html.Raw(comment.Content)
                        </div>
                        <div class="blog-meta">
                            <span><i class="bi bi-clock me-1"></i>@comment.CreatedAt.ToString("dd/MM/yyyy HH:mm")</span>

                            @if (comment.Post != null)
                            {
                                <span class="ms-3">
                                    <i class="bi bi-file-text me-1"></i>Trong bài viết:
                                    <a href="@Url.Action("Details", "Posts", new { id = comment.PostId })" title="@comment.Post.Title">
                                        @(comment.Post.Title != null && comment.Post.Title.Length > 50
                                            ? comment.Post.Title.Substring(0, 50) + "..."
                                            : comment.Post.Title ?? "Không có tiêu đề")
                                    </a>
                                </span>
                            }
                            else
                            {
                                <span class="ms-3 text-warning">
                                    <i class="bi bi-exclamation-triangle me-1"></i>Bài viết liên quan không còn tồn tại
                                </span>
                            }
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="alert alert-info text-center">Bạn chưa có bình luận nào.</div>
        }
    </div>
</div>
                    


            <div class="content-section" id="dia-diem-yeu-thich">
                <h3 class="section-title">Địa điểm yêu thích</h3>
                <div class="travel-inspiration">
                    @foreach (var favorite in Model.SpotFavorites.Take(3))
                    {
                        <div class="inspiration-card">
                            <img src="@favorite.Spot.ImageUrl" alt="@favorite.Spot.Name">
                            <div class="inspiration-content">
                                <div class="inspiration-title">@favorite.Spot.Name</div>
                                <div class="inspiration-description">@favorite.Spot.Description</div>
                                <div class="inspiration-meta">
                                    @* <span>Thời gian tốt nhất: @favorite.Spot.BestTimeToVisit</span> *@
                                    <span>Đã lưu</span>
                                </div>
                            </div>
                        </div>
                    }
                    @if (Model.SpotFavorites.Count == 0)
                    {
                        <div class="alert alert-info text-center">Bạn chưa có địa điểm yêu thích.</div>
                    }
                </div>
            </div>

            <div class="content-section" id="bai-viet-yeu-thich">
                <h3 class="section-title">Bài viết yêu thích</h3>
                <div class="favorite-posts">
                    @foreach (var favorite in Model.PostFavorites.Take(4))
                    {
                        <div class="favorite-post-card">
                            <img src="@favorite.Post.ImageUrl" alt="@favorite.Post.Title">
                            <div class="favorite-post-content">
                                <div class="favorite-post-title">@favorite.Post.Title</div>
                                <div class="favorite-post-author">
                                    <img src="@favorite.Post.User.AvatarUrl" alt="@favorite.Post.User.FullName">
                                    <div class="favorite-post-author-name">@favorite.Post.User.FullName • @favorite.Post.CreatedAt.ToString("dd/MM/yyyy")</div>
                                </div>
                            </div>
                        </div>
                    }
                    @if (Model.PostFavorites.Count == 0)
                    {
                        <div class="alert alert-info text-center">Bạn chưa có bài viết yêu thích.</div>
                    }
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
<script>
    // JavaScript để xử lý cuộn trang và hiệu ứng mượt mà
    document.addEventListener('DOMContentLoaded', function () {
        // Thêm hiệu ứng cuộn mượt mà cho các liên kết trong menu
        const menuItems = document.querySelectorAll('.profile-menu a');
        menuItems.forEach(item => {
            item.addEventListener('click', function (e) {
                // Ngừng hành động mặc định để ngăn trang tự động cuộn
                e.preventDefault();

                // Lấy mục tiêu cuộn và cuộn đến đó
                const targetId = this.getAttribute('href').substring(1); // Loại bỏ dấu # từ href
                const targetElement = document.getElementById(targetId);
                window.scrollTo({
                    top: targetElement.offsetTop - 50, // Để cho phần trên của mục cuộn cách một chút
                    behavior: 'smooth'
                });

                // Thêm hiệu ứng active cho menu
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Thêm hiệu ứng active cho các tab
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Xóa lớp 'active' khỏi tất cả các tab và tab content
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Thêm lớp 'active' vào tab đã nhấn và phần nội dung tương ứng
                tab.classList.add('active');
                const activeTab = tab.getAttribute('data-tab');
                document.getElementById(`${activeTab}-tab`).classList.add('active');
            });
        });
    });
    function enablePhoneEdit() {
        const input = document.getElementById('PhoneNumberInput');
        input.classList.remove('d-none');
        input.focus();
    }
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function(e) {
                document.getElementById('avatarPreview').src = e.target.result;
            }
            
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
}
<style>
    .avatar-container:hover .avatar-overlay {
        opacity: 1;
        cursor: pointer;
    }
    
    .hover-bg:hover {
        background-color: #f0f0f0 !important;
        transition: background-color 0.2s ease;
    }
    
    .cursor-pointer {
        cursor: pointer;
    }
    
    .object-fit-cover {
        object-fit: cover;
    }
</style>