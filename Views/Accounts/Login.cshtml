@* @{
    ViewData["Title"] = "Đăng Nhập";
    string facebookAppId = "1041418547323421"; // ID Facebook của bạn
                                               // !!! THAY THẾ BẰNG GOOGLE CLIENT ID THẬT CỦA BẠN !!!
    string googleClientId = "74136756439-vmv7kvaot8666ga0rubg2ccn3rkdqp6j.apps.googleusercontent.com";
}

@section Styles {
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-hover: #3a56d4;
            --text-color: #212529;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        /* Nếu _Layout.cshtml đã có style cho body, bạn có thể không cần phần này
                                                                       Hoặc bạn có thể thêm một class đặc biệt cho body của trang login
                                                                       và chỉ style class đó để tránh ảnh hưởng trang khác.
                                                                       Ví dụ: body.page-login { background-color: #eef2f7; }
                                                                    */

        .login-card-wrapper {
            /* Class mới để chứa login-card và link đăng ký */
            width: 100%;
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 35px 30px;
            text-align: center;
            width: 100%;
        }

        .login-card .logo-img {
            margin-bottom: 20px;
            border-radius: 50%;
            width: 90px;
            height: 80px;
            object-fit: cover;
        }

        .login-card h2 {
            color: var(--text-color);
            font-weight: 600;
            margin-bottom: 25px;
            font-size: 26px;
        }

        .form-control {
            border: 1px solid #ced4da;
            padding: 10px 15px;
            height: auto;
            font-size: 1rem;
            transition: all 0.2s ease-in-out;
            border-radius: 0.375rem;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.15);
        }

        .input-group {
            margin-bottom: 1.25rem;
        }

        .input-group-text {
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
            color: #495057;
        }

        .toggle-password {
            cursor: pointer;
        }

        .btn {
            padding: 10px 15px;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 0.375rem;
            transition: all 0.2s ease-in-out;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            border-color: var(--primary-hover);
        }

        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 20px 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #dee2e6;
        }

        .divider::before {
            margin-right: .5em;
        }

        .divider::after {
            margin-left: .5em;
        }

        .social-login .btn {
            margin-bottom: 10px;
        }

        .btn-facebook {
            background-color: #3b5998;
            color: white;
        }

        .btn-facebook:hover {
            background-color: #2d4373;
            color: white;
        }

        .form-check {
            text-align: left;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .form-check-input {
            margin-top: 0.1em;
            margin-right: 0.5em;
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .form-footer a,
        .register-link-container a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease-in-out;
        }

        .form-footer a:hover,
        .register-link-container a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        .register-link-container {
            margin-top: 1.5rem;
            font-size: 0.95rem;
        }

        .alert {
            border-radius: 0.375rem;
            padding: 0.8rem 1rem;
            margin-bottom: 1.25rem;
            border: none;
            font-size: 0.9rem;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .alert-success {
            background-color: #d1e7dd;
            color: #0f5132;
            border-color: #badbcc;
        }

        @@media (max-width: 576px) {
            .login-card {
                padding: 25px 15px;
            }

            .login-card h2 {
                font-size: 22px;
                margin-bottom: 20px;
            }

            .social-login .btn,
            .btn-primary {
                font-size: 0.95rem;
            }
        }
    </style>
}

<div class="container"> 
    <div class="row justify-content-center">
        <div class="col-12 col-sm-8 col-md-7 col-lg-5 col-xl-4 mt-5 mb-5 login-card-wrapper">
            <div class="login-card">
                <a asp-controller="Home" asp-action="Index">
                    <img src="/images/logo3.jpg" alt="Logo" class="logo-img">
                </a>
                <h2>Đăng Nhập</h2>

                @if (ViewBag.SuccessMessage != null)
                {
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>@ViewBag.SuccessMessage
                    </div>
                }
                @if (ViewBag.ErrorMessage != null)
                {
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle me-2"></i>@ViewBag.ErrorMessage
                    </div>
                }
                @if (TempData["FacebookLoginError"] != null)
                {
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle me-2"></i>@TempData["FacebookLoginError"]
                    </div>
                }
                @if (TempData["GoogleLoginError"] != null)
                {
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle me-2"></i>@TempData["GoogleLoginError"]
                    </div>
                }


                <form method="post" asp-action="Login" asp-controller="Accounts">
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-user"></i></span>
                        <input type="text" name="UsernameOrEmail" class="form-control"
                            placeholder="Tên đăng nhập hoặc Email" required />
                    </div>

                    <div class="input-group">
                        <span class="input-group-text"><i class="fa fa-lock"></i></span>
                        <input type="password" name="Password" id="password" class="form-control" placeholder="Mật khẩu"
                            required />
                        <span class="input-group-text toggle-password"><i class="fa fa-eye"></i></span>
                    </div>

                    <div class="form-footer">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="RememberMe" id="remember" />
                            <label class="form-check-label" for="remember">Nhớ mật khẩu</label>
                        </div>
                        <a asp-controller="Accounts" asp-action="ForgotPassword">Quên mật khẩu?</a>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">Đăng Nhập</button>
                    </div>
                </form>

                <div class="divider">hoặc</div>

                <div class="social-login">
                    <button type="button" id="btnFacebookLogin" class="btn btn-facebook w-100">
                        <i class="fab fa-facebook-square me-2"></i>Đăng nhập với Facebook
                    </button>
                    <div id="googleButtonRenderLocation" class="w-100 d-flex justify-content-center mt-2"></div>
                </div>
            </div>

            <div class="text-center register-link-container">
                <span>Chưa có tài khoản? </span>
                <a class="fw-bold" asp-controller="Accounts" asp-action="Register">Đăng ký ngay</a>
            </div>
        </div>
    </div>
</div>

<!-- Form ẩn để gửi dữ liệu Facebook lên server -->
<form id="facebookLoginForm" asp-action="FacebookLogin" asp-controller="Accounts" method="post" style="display:none;">
    <input type="hidden" name="FacebookUserId" id="fbUserId" />
    <input type="hidden" name="Email" id="fbEmail" />
    <input type="hidden" name="FullName" id="fbFullName" />
    <input type="hidden" name="AccessToken" id="fbAccessToken" />
    @Html.AntiForgeryToken()
</form>

<!-- Form ẩn để gửi ID Token của Google lên server -->
<form id="googleLoginForm" asp-action="GoogleLogin" asp-controller="Accounts" method="post" style="display:none;">
    <input type="hidden" name="IdToken" id="googleIdToken" />
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        // Toggle Password Visibility
        var togglePasswordButton = document.querySelector(".toggle-password");
        if (togglePasswordButton) {
            togglePasswordButton.addEventListener("click", function () {
                let passwordInput = document.getElementById("password");
                let icon = this.querySelector("i");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    icon.classList.remove("fa-eye");
                    icon.classList.add("fa-eye-slash");
                } else {
                    passwordInput.type = "password";
                    icon.classList.remove("fa-eye-slash");
                    icon.classList.add("fa-eye");
                }
            });
        }

        // --- Facebook Login Script ---
        const facebookAppIdConst = "@facebookAppId";
        window.fbAsyncInit = function () {
            console.log("Facebook SDK loaded, fbAsyncInit called.");
            FB.init({
                appId: facebookAppIdConst,
                cookie: true,
                xfbml: true,
                version: 'v19.0'
            });
            console.log("FB.init completed for App ID: " + facebookAppIdConst);
        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { console.log("Facebook SDK script already exists."); return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/vi_VN/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
            console.log("Facebook SDK script inserted.");
        }(document, 'script', 'facebook-jssdk'));

        var fbButton = document.getElementById('btnFacebookLogin');
        if (fbButton) {
            fbButton.addEventListener('click', function () {
                console.log("Facebook login button clicked.");
                if (typeof FB !== 'undefined' && FB.login) {
                    FB.login(function (response) {
                        if (response.authResponse) {
                            console.log('Facebook: Authentication successful. Fetching user data...');
                            FB.api('/me', { fields: 'id,name,email' }, function (userData) {
                                console.log('Facebook: User data received:', userData);
                                document.getElementById('fbUserId').value = userData.id;
                                document.getElementById('fbEmail').value = userData.email || '';
                                document.getElementById('fbFullName').value = userData.name;
                                document.getElementById('fbAccessToken').value = response.authResponse.accessToken;
                                console.log('Facebook: Submitting form to server...');
                                document.getElementById('facebookLoginForm').submit();
                            });
                        } else {
                            console.log('Facebook: User cancelled login or did not fully authorize.');
                        }
                    }, { scope: 'email,public_profile' });
                } else {
                    console.error("FB.login is not available. Facebook SDK might not be fully initialized or error during init.");
                }
            });
        } else {
            console.warn("Facebook login button not found.");
        }
    </script>

    <script src="https://accounts.google.com/gsi/client" async defer onload="onGoogleLibraryLoad"></script>
    <script>
        const googleClientIdConst = "@googleClientId";

        function handleGoogleCredentialResponse(response) {
            console.log("Google Sign-In Response Received.");
            if (response.credential) {
                console.log("Encoded JWT ID token (first 30 chars): " + response.credential.substring(0, 30) + "...");
                document.getElementById('googleIdToken').value = response.credential;
                console.log("Submitting Google login form with ID Token...");
                document.getElementById('googleLoginForm').submit();
            } else {
                console.error("Google Sign-In: No credential received in response.", response);
            }
        }

        function onGoogleLibraryLoad() {
            console.log("Google GSI client library has loaded via onload attribute.");
            if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
                try {
                    google.accounts.id.initialize({
                        client_id: googleClientIdConst,
                        callback: handleGoogleCredentialResponse
                    });
                    console.log("Google GIS initialized with Client ID: " + googleClientIdConst);

                    var googleButtonRenderDiv = document.getElementById("googleButtonRenderLocation");
                    if (googleButtonRenderDiv) {
                        console.log("Rendering Google Sign-In button...");
                        google.accounts.id.renderButton(
                            googleButtonRenderDiv,
                            {
                                theme: "outline", size: "large", type: "standard",
                                shape: "rectangular", text: "signin_with", logo_alignment: "left",
                                width: "100%" // Để nút Google chiếm 100% div cha là .googleButtonRenderLocation
                            }
                        );
                        console.log("Google Sign-In button render attempt made.");
                    } else {
                        console.error("Element with ID 'googleButtonRenderLocation' not found for Google button.");
                    }
                } catch (e) {
                    console.error("Error during Google Sign-In initialization or rendering: ", e);
                }
            } else {
                console.error("Google Identity Services (GIS) library loaded, but 'google.accounts.id' is undefined.");
            }
        }
    </script>
} *@
@{
    ViewData["Title"] = "Đăng Nhập";
    string facebookAppId = "1041418547323421"; // ID Facebook của bạn
    string googleClientId = "74136756439-vmv7kvaot8666ga0rubg2ccn3rkdqp6j.apps.googleusercontent.com";
}

@section Styles {
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-hover: #3a56d4;
            --primary-light: rgba(67, 97, 238, 0.1);
            --primary-shadow: rgba(67, 97, 238, 0.2);
            --success-color: #38b000;
            --success-hover: #2d9200;
            --facebook-color: #1877f2;
            --facebook-hover: #0a58ca;
            --text-color: #2b3044;
            --text-secondary: #6c757d;
            --border-radius: 16px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        body {
            background: url('/images/cau.jpg') no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }

        .login-card-wrapper {
            width: 100%;
            /* This is correct as it's inside a Bootstrap column */
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 3rem;
            text-align: center;
            /* width: 100%; */
            /* MODIFIED: Commented out or removed this line */
            max-width: 50%;
            /* ADDED: Make the card 70% of its wrapper's width */
            margin-left: auto;
            /* ADDED: Center the card within the wrapper */
            margin-right: auto;
            /* ADDED: Center the card within the wrapper */
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease-in-out;
        }

        keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            @* background: #ff7e5b; *@
        }

        .login-card .logo-container {
            margin-bottom: 2rem;
        }

        .login-card .logo-img {
            border-radius: 50%;
            width: 90px;
            height: 90px;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .login-card .logo-img:hover {
            transform: scale(1.05);
        }

        .login-card h2 {
            color: var(--text-color);
            font-weight: 700;
            margin-bottom: 1.5rem;
            font-size: 28px;
            position: relative;
            display: inline-block;
        }

        .login-card h2::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            @* background-color: var(--primary-color); *@
            border-radius: 3px;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .form-control {
            display: block;
            width: 100%;
            padding: 0.8rem 1rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: var(--text-color);
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-shadow);
            outline: 0;
        }

        .input-group {
            position: relative;
            display: flex;
            flex-wrap: wrap;
            align-items: stretch;
            width: 100%;
            margin-bottom: 0;
        }

        .input-group .form-control {
            position: relative;
            flex: 1 1 auto;
            width: 1%;
            min-width: 0;
            border-radius: 8px;
            padding-left: 48px;
        }

        .input-group-text {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            border: none;
            z-index: 10;
            color: var(--text-secondary);
        }

        .password-toggle {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            border: none;
            z-index: 10;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .toggle-password {
            background: transparent;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }

        .toggle-password:hover {
            color: var(--primary-color);
        }

        .btn {
            display: inline-block;
            font-weight: 500;
            color: #fff;
            text-align: center;
            vertical-align: middle;
            user-select: none;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: 8px;
            transition: all 0.15s ease-in-out;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            z-index: -1;
        }

        .btn:hover::before {
            left: 0;
        }

        .btn-primary {
            @* background-color: #ff7e5b; *@
            border: none;
            box-shadow: 0 4px 15px var(--primary-shadow);
        }

        .btn-primary:hover {
            @* background-color: #ff7e5b; *@
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--primary-shadow);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 4px 15px var(--primary-shadow);
        }

        .btn-facebook {
            background-color: var(--facebook-color);
            border: none;
            color: white;
            box-shadow: 0 4px 15px rgba(24, 119, 242, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-facebook:hover {
            background-color: var(--facebook-hover);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(24, 119, 242, 0.3);
        }

        .btn-facebook:active {
            transform: translateY(0);
        }

        .btn-facebook i {
            font-size: 1.2rem;
        }

        .w-100 {
            width: 100%;
        }

        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #dee2e6;
        }

        .divider::before {
            margin-right: 1em;
        }

        .divider::after {
            margin-left: 1em;
        }

        .social-login {
            margin-bottom: 0.5rem;
        }

        .social-login #googleButtonRenderLocation {
            margin-top: 0.75rem;
        }

        .form-check {
            text-align: left;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            margin: 0;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
            margin-top: 0;
            margin-right: 0.5rem;
            cursor: pointer;
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-check-label {
            cursor: pointer;
            user-select: none;
        }

        .form-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            position: relative;
        }

        .form-footer a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        .form-footer a:hover {
            color: var(--primary-hover);
        }

        .form-footer a:hover::after {
            width: 100%;
        }

        .register-link-container {
            margin-top: 2rem;
            font-size: 1rem;
            color: #ffffff;
        }

        .register-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            position: relative;
            transition: all 0.2s ease;
        }

        .register-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        .register-link:hover {
            color: var(--primary-hover);
        }

        .register-link:hover::after {
            width: 100%;
        }

        .alert {
            position: relative;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-weight: 500;
            animation: slideDown 0.3s ease-in-out;
        }

        keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-danger {
            background-color: #ff5a5f;
            box-shadow: 0 5px 15px rgba(255, 90, 95, 0.2);
        }

        .alert-success {
            background-color: var(--success-color);
            box-shadow: 0 5px 15px rgba(56, 176, 0, 0.2);
        }

        .text-danger {
            color: #ff5a5f;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: block;
        }

        .icon-vibrate {
            animation: vibrate 0.5s cubic-bezier(.36, .07, .19, .97) both;
        }

        keyframes vibrate {

            0%,
            100% {
                transform: translateX(0);
            }

            20% {
                transform: translateX(-2px);
            }

            40% {
                transform: translateX(2px);
            }

            60% {
                transform: translateX(-2px);
            }

            80% {
                transform: translateX(2px);
            }
        }

        /* MODIFIED: Added  symbol for media queries */
        media (max-width: 768px) {
            .login-card {
                padding: 2rem 1.5rem;
                /* If 70% is too small here, you can adjust: e.g., max-width: 85%; */
            }
        }

        media (max-width: 576px) {
            .login-card {
                padding: 1.5rem 1rem;
                border-radius: 12px;
                /* If 70% is too small here, you can adjust: e.g., max-width: 95%; */
            }
        }
    </style>
}

<div class="login-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5 login-card-wrapper">
                <div class="login-card">
                    <div class="logo-container">
                        <a asp-controller="Home" asp-action="Index">
                            <img src="/images/logo3.jpg" alt="Logo" class="logo-img">
                        </a>
                    </div>
                    <h2>Đăng Nhập</h2>

                    @if (ViewBag.SuccessMessage != null)
                    {
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>@ViewBag.SuccessMessage
                        </div>
                    }
                    @if (ViewBag.ErrorMessage != null)
                    {
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle me-2 icon-vibrate"></i>@ViewBag.ErrorMessage
                        </div>
                    }
                    @if (TempData["FacebookLoginError"] != null)
                    {
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle me-2 icon-vibrate"></i>@TempData["FacebookLoginError"]
                        </div>
                    }
                    @if (TempData["GoogleLoginError"] != null)
                    {
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle me-2 icon-vibrate"></i>@TempData["GoogleLoginError"]
                        </div>
                    }

                    <form method="post" asp-action="Login" asp-controller="Accounts" class="login-form">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        <div class="form-group">
                            <label class="form-label" for="UsernameOrEmail">Tên đăng nhập hoặc Email</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fa fa-user"></i></span>
                                <input type="text" name="UsernameOrEmail" class="form-control"
                                    placeholder="Nhập tên đăng nhập hoặc email" required />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="Password">Mật khẩu</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fa fa-lock"></i></span>
                                <input type="password" name="Password" id="password" class="form-control"
                                    placeholder="Nhập mật khẩu" required />
                                <button type="button" class="password-toggle toggle-password">
                                    <i class="fa fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-footer">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="RememberMe" id="remember" />
                                <label class="form-check-label" for="remember">Nhớ mật khẩu</label>
                            </div>
                            <a asp-controller="Accounts" asp-action="ForgotPassword">Quên mật khẩu?</a>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt me-2"></i>Đăng Nhập
                        </button>
                    </form>

                    <div class="divider">hoặc tiếp tục với</div>

                    <div class="social-login">
                        <button type="button" id="btnFacebookLogin" class="btn btn-facebook w-100">
                            <i class="fab fa-facebook-square"></i>Đăng nhập với Facebook
                        </button>
                        <div id="googleButtonRenderLocation" class="w-100 d-flex justify-content-center"></div>
                    </div>
                </div>

                <div class="text-center register-link-container">
                    <span>Chưa có tài khoản? </span>
                    <a class="register-link" asp-controller="Accounts" asp-action="Register">Đăng ký ngay</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Form ẩn để gửi dữ liệu Facebook lên server -->
<form id="facebookLoginForm" asp-action="FacebookLogin" asp-controller="Accounts" method="post" style="display:none;">
    <input type="hidden" name="FacebookUserId" id="fbUserId" />
    <input type="hidden" name="Email" id="fbEmail" />
    <input type="hidden" name="FullName" id="fbFullName" />
    <input type="hidden" name="AccessToken" id="fbAccessToken" />
    @Html.AntiForgeryToken()
</form>

<!-- Form ẩn để gửi ID Token của Google lên server -->
<form id="googleLoginForm" asp-action="GoogleLogin" asp-controller="Accounts" method="post" style="display:none;">
    <input type="hidden" name="IdToken" id="googleIdToken" />
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        // Toggle Password Visibility
        const togglePasswordButton = document.querySelector(".toggle-password");
        if (togglePasswordButton) {
            togglePasswordButton.addEventListener("click", function () {
                const passwordInput = document.getElementById("password");
                const icon = this.querySelector("i");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    icon.classList.remove("fa-eye");
                    icon.classList.add("fa-eye-slash");
                } else {
                    passwordInput.type = "password";
                    icon.classList.remove("fa-eye-slash");
                    icon.classList.add("fa-eye");
                }
            });
        }

        // Add animation to form inputs
        const formInputs = document.querySelectorAll('.form-control');
        formInputs.forEach(input => {
            input.addEventListener('focus', function () {
                this.parentElement.style.transition = 'transform 0.2s ease';
                this.parentElement.style.transform = 'translateY(-2px)';
            });

            input.addEventListener('blur', function () {
                this.parentElement.style.transform = 'translateY(0)';
            });
        });

        // --- Facebook Login Script ---
        const facebookAppIdConst = "@facebookAppId";
        window.fbAsyncInit = function () {
            console.log("Facebook SDK loaded, fbAsyncInit called.");
            FB.init({
                appId: facebookAppIdConst,
                cookie: true,
                xfbml: true,
                version: 'v19.0'
            });
            console.log("FB.init completed for App ID: " + facebookAppIdConst);
        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { console.log("Facebook SDK script already exists."); return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/vi_VN/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
            console.log("Facebook SDK script inserted.");
        }(document, 'script', 'facebook-jssdk'));

        const fbButton = document.getElementById('btnFacebookLogin');
        if (fbButton) {
            fbButton.addEventListener('click', function () {
                console.log("Facebook login button clicked.");
                if (typeof FB !== 'undefined' && FB.login) {
                    FB.login(function (response) {
                        if (response.authResponse) {
                            console.log('Facebook: Authentication successful. Fetching user data...');
                            FB.api('/me', { fields: 'id,name,email' }, function (userData) {
                                console.log('Facebook: User data received:', userData);
                                document.getElementById('fbUserId').value = userData.id;
                                document.getElementById('fbEmail').value = userData.email || '';
                                document.getElementById('fbFullName').value = userData.name;
                                document.getElementById('fbAccessToken').value = response.authResponse.accessToken;
                                console.log('Facebook: Submitting form to server...');
                                document.getElementById('facebookLoginForm').submit();
                            });
                        } else {
                            console.log('Facebook: User cancelled login or did not fully authorize.');
                        }
                    }, { scope: 'email,public_profile' });
                } else {
                    console.error("FB.login is not available. Facebook SDK might not be fully initialized or error during init.");
                }
            });
        } else {
            console.warn("Facebook login button not found.");
        }
    </script>

    @* --- Google Login Script --- *@
    <script src="https://accounts.google.com/gsi/client" async defer onload="onGoogleLibraryLoad"></script>
    <script>
        const googleClientIdConst = "@googleClientId";

        function handleGoogleCredentialResponse(response) {
            console.log("Google Sign-In Response Received.");
            if (response.credential) {
                console.log("Encoded JWT ID token (first 30 chars): " + response.credential.substring(0, 30) + "...");
                document.getElementById('googleIdToken').value = response.credential;
                console.log("Submitting Google login form with ID Token...");
                document.getElementById('googleLoginForm').submit();
            } else {
                console.error("Google Sign-In: No credential received in response.", response);
            }
        }

        function onGoogleLibraryLoad() {
            console.log("Google GSI client library has loaded via onload attribute.");
            if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
                try {
                    google.accounts.id.initialize({
                        client_id: googleClientIdConst,
                        callback: handleGoogleCredentialResponse
                    });
                    console.log("Google GIS initialized with Client ID: " + googleClientIdConst);

                    const googleButtonRenderDiv = document.getElementById("googleButtonRenderLocation");
                    if (googleButtonRenderDiv) {
                        console.log("Rendering Google Sign-In button...");
                        google.accounts.id.renderButton(
                            googleButtonRenderDiv,
                            {
                                theme: "outline",
                                size: "large",
                                type: "standard",
                                shape: "rectangular",
                                text: "signin_with",
                                logo_alignment: "left",
                                width: googleButtonRenderDiv.offsetWidth
                            }
                        );
                        console.log("Google Sign-In button render attempt made.");
                    } else {
                        console.error("Element with ID 'googleButtonRenderLocation' not found for Google button.");
                    }
                } catch (e) {
                    console.error("Error during Google Sign-In initialization or rendering: ", e);
                }
            } else {
                console.error("Google Identity Services (GIS) library loaded, but 'google.accounts.id' is undefined.");
            }
        }
    </script>
}